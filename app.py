from flask import Flask, render_template_string, jsonify
import os
import requests

app = Flask(__name__)

HTML_TEMPLATE = '''
<!DOCTYPE html>
<html>
<head>
    <title>Salesforce Authenticator</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: sans-serif;
        }
        .top-bar {
            background-color: #f4f4f4;
            padding: 10px;
            text-align: center;
            box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
        }
        #secretDisplay {
            padding: 20px;
            font-family: monospace;
            background-color: #fafafa;
            border-top: 1px solid #ddd;
            white-space: pre-wrap;
        }
        #resultFrame {
            display: none;
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div class="top-bar" id="topBar">
        <svg onclick="sendKey()" style="cursor: pointer;"width="150" height="46" viewBox="0 0 150 46" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="0.5" y="0.5" width="149" height="45" rx="6.5" fill="#0374BB"/>
<rect x="0.5" y="0.5" width="149" height="45" rx="6.5" stroke="#D9D9D9"/>
<g clip-path="url(#clip0_55_101)">
<path d="M19.9677 27.2807H19.8831L19.5578 25.3602C19.5386 25.2468 19.4872 25.1413 19.4098 25.0562C19.3325 24.9711 19.2323 24.91 19.1212 24.88C18.7281 24.7743 18.3503 24.6181 17.9972 24.4154C17.899 24.359 17.7869 24.3314 17.6737 24.3358C17.5605 24.3402 17.4509 24.3764 17.3574 24.4403L15.9347 25.4134L15.2516 24.7305L16.2247 23.3078C16.2887 23.2143 16.325 23.1046 16.3294 22.9913C16.3338 22.878 16.3061 22.7658 16.2496 22.6676C16.0467 22.3146 15.8906 21.9368 15.7849 21.5436C15.7555 21.4342 15.6957 21.3354 15.6126 21.2586C15.5295 21.1817 15.4263 21.1299 15.315 21.109L13.6197 20.7911V19.825L15.315 19.5071C15.4263 19.4862 15.5295 19.4344 15.6126 19.3575C15.6957 19.2807 15.7555 19.1819 15.7849 19.0725C15.8905 18.6793 16.0466 18.3014 16.2496 17.9485C16.3061 17.8503 16.3338 17.7381 16.3294 17.6248C16.325 17.5116 16.2887 17.4018 16.2247 17.3083L15.2516 15.8858L15.9347 15.2026L17.3574 16.176C17.4509 16.2399 17.5605 16.2762 17.6737 16.2806C17.7869 16.2849 17.899 16.2573 17.9972 16.2008C18.3503 15.9981 18.7281 15.8419 19.1212 15.7362C19.2305 15.7067 19.3292 15.647 19.4061 15.5639C19.4829 15.4808 19.5348 15.3777 19.5556 15.2664L19.874 13.5709H20.84L21.1582 15.2663C21.1791 15.3776 21.2309 15.4807 21.3078 15.5638C21.3846 15.6469 21.4833 15.7066 21.5926 15.7361C21.9858 15.8418 22.3636 15.998 22.7167 16.2007C22.8148 16.2572 22.927 16.2849 23.0402 16.2805C23.1533 16.2761 23.263 16.2399 23.3565 16.1759L24.7792 15.2025L25.4623 15.8857L24.4891 17.3084C24.4251 17.4019 24.3888 17.5116 24.3844 17.6248C24.3801 17.738 24.4077 17.8501 24.4643 17.9483C24.667 18.3014 24.8232 18.6793 24.9289 19.0725C24.9585 19.1824 25.0187 19.2815 25.1024 19.3585C25.1862 19.4355 25.29 19.4872 25.4019 19.5076L27.1606 19.8277V20.0781C27.1606 20.2377 27.224 20.3907 27.3368 20.5035C27.4496 20.6163 27.6026 20.6797 27.7622 20.6797C27.9217 20.6797 28.0747 20.6163 28.1875 20.5035C28.3003 20.3907 28.3637 20.2377 28.3637 20.0781V19.3258C28.3637 19.185 28.3143 19.0486 28.224 18.9405C28.1338 18.8323 28.0085 18.7593 27.8699 18.734L25.978 18.3896C25.8963 18.1496 25.7994 17.9151 25.6876 17.6875L26.7373 16.1532C26.8165 16.0374 26.8528 15.8976 26.8398 15.7579C26.8268 15.6182 26.7653 15.4874 26.6661 15.3882L25.277 13.9991C25.1778 13.8998 25.0471 13.8384 24.9073 13.8254C24.7676 13.8124 24.6278 13.8486 24.512 13.9279L22.9775 14.9774C22.7493 14.8654 22.514 14.7682 22.2732 14.6865L21.9302 12.8585C21.9043 12.7206 21.8311 12.5961 21.7231 12.5065C21.6152 12.4169 21.4793 12.3678 21.339 12.3678H19.3749C19.2346 12.3678 19.0987 12.4168 18.9907 12.5064C18.8828 12.596 18.8095 12.7205 18.7836 12.8584L18.4405 14.6864C18.1997 14.7681 17.9645 14.8653 17.7362 14.9773L16.2019 13.9278C16.0861 13.8485 15.9462 13.8122 15.8065 13.8252C15.6668 13.8382 15.536 13.8997 15.4368 13.999L14.0477 15.3881C13.9485 15.4873 13.8871 15.6181 13.8741 15.7578C13.8611 15.8975 13.8974 16.0374 13.9766 16.1532L15.0263 17.6873C14.9142 17.9156 14.817 18.1509 14.7352 18.3917L12.9075 18.7345C12.7696 18.7603 12.6451 18.8336 12.5554 18.9416C12.4658 19.0495 12.4168 19.1854 12.4167 19.3257V21.2902C12.4168 21.4305 12.4658 21.5664 12.5554 21.6744C12.6451 21.7824 12.7696 21.8556 12.9075 21.8815L14.7354 22.2242C14.8171 22.4651 14.9143 22.7005 15.0264 22.9289L13.9766 24.4631C13.8974 24.5789 13.8611 24.7187 13.8741 24.8585C13.8871 24.9982 13.9485 25.1289 14.0477 25.2281L15.4368 26.6169C15.5361 26.716 15.6669 26.7773 15.8065 26.7903C15.9462 26.8033 16.086 26.7671 16.2019 26.688L17.7363 25.6387C17.9624 25.7496 18.1953 25.846 18.4336 25.9272L18.7817 27.9826C18.8055 28.1228 18.8781 28.2499 18.9867 28.3416C19.0952 28.4333 19.2327 28.4837 19.3749 28.4837H19.9677C20.1272 28.4837 20.2803 28.4203 20.3931 28.3075C20.5059 28.1947 20.5693 28.0417 20.5693 27.8821C20.5693 27.7226 20.5059 27.5696 20.3931 27.4568C20.2803 27.3439 20.1272 27.2807 19.9677 27.2807Z" fill="white" stroke="#0374BB" stroke-width="0.3"/>
<path d="M20.3568 17.2822C19.7584 17.2822 19.1733 17.4597 18.6758 17.7922C18.1782 18.1247 17.7904 18.5973 17.5613 19.1502C17.3323 19.7031 17.2724 20.3115 17.3892 20.8985C17.506 21.4854 17.7942 22.0246 18.2174 22.4478C18.6406 22.8709 19.1797 23.1591 19.7667 23.2758C20.3536 23.3926 20.962 23.3326 21.5149 23.1036C22.0678 22.8746 22.5404 22.4867 22.8729 21.9891C23.2053 21.4915 23.3828 20.9065 23.3828 20.308C23.3819 19.5058 23.0628 18.7366 22.4955 18.1694C21.9282 17.6021 21.1591 17.2831 20.3568 17.2822ZM20.3568 22.1308C19.9963 22.1308 19.6439 22.0239 19.3442 21.8236C19.0445 21.6233 18.8109 21.3386 18.6729 21.0056C18.535 20.6725 18.4989 20.306 18.5692 19.9525C18.6395 19.5989 18.8131 19.2741 19.0681 19.0192C19.323 18.7643 19.6477 18.5907 20.0013 18.5204C20.3549 18.45 20.7214 18.4861 21.0544 18.6241C21.3875 18.762 21.6721 18.9957 21.8724 19.2954C22.0727 19.5951 22.1796 19.9475 22.1796 20.308C22.1792 20.7913 21.987 21.2547 21.6452 21.5964C21.3035 21.9382 20.8401 22.1303 20.3568 22.1308Z" fill="white" stroke="#0374BB" stroke-width="0.3"/>
<path d="M33.0925 26.2306L31.8155 25.9911C31.7688 25.8626 31.7167 25.7365 31.659 25.613L32.3925 24.541C32.4718 24.4252 32.508 24.2853 32.495 24.1456C32.482 24.0059 32.4206 23.8751 32.3214 23.7759L31.2851 22.7394C31.1859 22.6402 31.0551 22.5787 30.9154 22.5657C30.7757 22.5527 30.6358 22.589 30.5201 22.6683L29.4478 23.4016C29.3243 23.344 29.1982 23.292 29.0695 23.2455L28.83 21.9682C28.8041 21.8303 28.7309 21.7058 28.6229 21.6162C28.5149 21.5266 28.379 21.4775 28.2387 21.4775H26.7732C26.6329 21.4775 26.497 21.5266 26.389 21.6162C26.281 21.7059 26.2078 21.8304 26.1819 21.9683L25.9425 23.2453C25.8139 23.2918 25.6878 23.3439 25.5641 23.4016L24.4923 22.6683C24.3765 22.589 24.2366 22.5527 24.0969 22.5657C23.9572 22.5787 23.8264 22.6401 23.7272 22.7394L22.6909 23.7759C22.5917 23.875 22.5303 24.0058 22.5173 24.1455C22.5043 24.2852 22.5405 24.425 22.6198 24.5408L23.3529 25.613C23.2955 25.7362 23.2435 25.8622 23.1968 25.9911L21.9198 26.2306C21.7819 26.2564 21.6574 26.3297 21.5678 26.4377C21.4781 26.5456 21.4291 26.6815 21.4291 26.8219V28.2875C21.4291 28.4278 21.4781 28.5636 21.5676 28.6716C21.6572 28.7796 21.7816 28.8528 21.9195 28.8788L23.1968 29.1186C23.2435 29.2472 23.2955 29.3732 23.3529 29.4967L22.6197 30.569C22.5404 30.6847 22.5041 30.8246 22.5171 30.9643C22.5301 31.1039 22.5916 31.2347 22.6908 31.3338L23.7271 32.3701C23.8263 32.4693 23.9571 32.5306 24.0968 32.5436C24.2365 32.5566 24.3763 32.5204 24.4921 32.4413L25.564 31.708C25.6876 31.7655 25.8137 31.8176 25.9423 31.8643L26.182 33.1414C26.2079 33.2793 26.2811 33.4038 26.3891 33.4934C26.4971 33.583 26.633 33.632 26.7733 33.632H28.2387C28.379 33.632 28.5149 33.583 28.6229 33.4934C28.7308 33.4038 28.8041 33.2793 28.83 33.1414L29.0696 31.8643C29.1982 31.8177 29.3243 31.7656 29.448 31.708L30.5202 32.4413C30.636 32.5204 30.7759 32.5566 30.9155 32.5436C31.0552 32.5306 31.186 32.4693 31.2852 32.3701L32.3215 31.3338C32.4207 31.2346 32.4822 31.1039 32.4952 30.9642C32.5081 30.8245 32.4719 30.6846 32.3927 30.5688L31.659 29.4968C31.7168 29.3735 31.7689 29.2474 31.8155 29.1187L33.0928 28.8789C33.2307 28.8529 33.3551 28.7797 33.4447 28.6717C33.5342 28.5637 33.5833 28.4279 33.5833 28.2876V26.822C33.5833 26.6816 33.5342 26.5457 33.4446 26.4377C33.355 26.3297 33.2304 26.2565 33.0925 26.2306ZM32.3803 27.7884L31.2396 28.0024C31.1283 28.0233 31.0253 28.0752 30.9422 28.152C30.8591 28.2289 30.7994 28.3277 30.7699 28.4369C30.6945 28.7176 30.583 28.9873 30.4383 29.2394C30.3817 29.3376 30.354 29.4497 30.3584 29.5629C30.3628 29.6761 30.3991 29.7858 30.4631 29.8792L31.1177 30.8361L30.7874 31.1665L29.8303 30.5119C29.7368 30.448 29.6271 30.4117 29.514 30.4073C29.4008 30.4029 29.2887 30.4306 29.1905 30.4871C28.9385 30.6318 28.6688 30.7433 28.3882 30.8187C28.2789 30.8482 28.1802 30.908 28.1033 30.9911C28.0265 31.0742 27.9746 31.1773 27.9538 31.2885L27.7396 32.4289H27.2723L27.0585 31.2885C27.0376 31.1772 26.9857 31.074 26.9088 30.9909C26.8319 30.9078 26.7331 30.848 26.6238 30.8186C26.3431 30.7432 26.0735 30.6318 25.8215 30.4871C25.7233 30.4307 25.6112 30.4031 25.498 30.4075C25.3848 30.4119 25.2752 30.4481 25.1817 30.5119L24.2249 31.1665L23.8946 30.8362L24.5489 29.8791C24.6129 29.7857 24.6492 29.6761 24.6536 29.5629C24.658 29.4497 24.6303 29.3376 24.5737 29.2394C24.4291 28.9874 24.3178 28.7176 24.2424 28.437C24.2129 28.3277 24.1532 28.2289 24.0701 28.1521C23.987 28.0752 23.884 28.0233 23.7727 28.0024L22.6322 27.7884V27.3211L23.7725 27.1073C23.8838 27.0864 23.987 27.0346 24.0701 26.9576C24.1533 26.8807 24.213 26.7819 24.2425 26.6726C24.3178 26.392 24.4292 26.1224 24.5738 25.8704C24.6304 25.7723 24.6581 25.6601 24.6537 25.5469C24.6493 25.4337 24.613 25.3241 24.549 25.2306L23.8943 24.2735L24.2249 23.9431L25.1817 24.5977C25.2752 24.6615 25.3848 24.6978 25.498 24.7022C25.6112 24.7066 25.7233 24.6789 25.8215 24.6225C26.0735 24.4778 26.3432 24.3664 26.6238 24.291C26.7332 24.2616 26.832 24.2018 26.9089 24.1187C26.9858 24.0355 27.0377 23.9323 27.0585 23.821L27.2723 22.6807H27.7396L27.9538 23.8212C27.9747 23.9324 28.0265 24.0355 28.1034 24.1186C28.1802 24.2017 28.2789 24.2615 28.3882 24.291C28.6688 24.3664 28.9385 24.4779 29.1905 24.6225C29.2887 24.679 29.4008 24.7067 29.514 24.7023C29.6272 24.6979 29.7368 24.6616 29.8303 24.5977L30.7874 23.9431L31.1177 24.2735L30.4631 25.2304C30.3991 25.3239 30.3628 25.4336 30.3584 25.5468C30.354 25.6601 30.3817 25.7722 30.4383 25.8704C30.583 26.1224 30.6945 26.392 30.7699 26.6726C30.7994 26.7819 30.8591 26.8807 30.9423 26.9576C31.0254 27.0346 31.1286 27.0864 31.2399 27.1073L32.3803 27.3211V27.7884Z" fill="white" stroke="#0374BB" stroke-width="0.3"/>
<path d="M27.5061 25.3013C27.0604 25.3013 26.6247 25.4334 26.2541 25.6811C25.8835 25.9287 25.5946 26.2807 25.4241 26.6924C25.2535 27.1042 25.2089 27.5573 25.2959 27.9945C25.3828 28.4316 25.5975 28.8332 25.9127 29.1483C26.2278 29.4635 26.6294 29.6781 27.0666 29.765C27.5037 29.852 27.9568 29.8073 28.3686 29.6367C28.7804 29.4661 29.1323 29.1773 29.3799 28.8067C29.6275 28.436 29.7596 28.0003 29.7596 27.5546C29.7589 26.9572 29.5213 26.3844 29.0988 25.962C28.6763 25.5395 28.1035 25.3019 27.5061 25.3013ZM27.5061 28.6052C27.2983 28.6052 27.0953 28.5436 26.9225 28.4281C26.7498 28.3127 26.6152 28.1487 26.5357 27.9568C26.4562 27.7648 26.4353 27.5536 26.4759 27.3499C26.5164 27.1461 26.6164 26.959 26.7633 26.8121C26.9102 26.6652 27.0973 26.5651 27.3011 26.5246C27.5048 26.484 27.716 26.5048 27.908 26.5843C28.0999 26.6638 28.264 26.7984 28.3794 26.9711C28.4948 27.1438 28.5565 27.3469 28.5565 27.5546C28.5562 27.8331 28.4454 28.1002 28.2485 28.2971C28.0516 28.494 27.7846 28.6048 27.5061 28.6052Z" fill="white" stroke="#0374BB" stroke-width="0.3"/>
</g>
<path d="M42.2482 28H40.6175L44.2816 17.8182H46.0565L49.7205 28H48.0898L45.2113 19.6676H45.1317L42.2482 28ZM42.5217 24.0128H47.8114V25.3054H42.5217V24.0128ZM55.9089 24.8331V20.3636H57.4004V28H55.9387V26.6776H55.8592C55.6835 27.0852 55.4018 27.425 55.014 27.6967C54.6296 27.9652 54.1506 28.0994 53.5772 28.0994C53.0867 28.0994 52.6525 27.9917 52.2747 27.7763C51.9002 27.5575 51.6052 27.2344 51.3897 26.8068C51.1776 26.3793 51.0716 25.8506 51.0716 25.2209V20.3636H52.5581V25.0419C52.5581 25.5623 52.7022 25.9766 52.9906 26.2848C53.2789 26.593 53.6535 26.7472 54.1142 26.7472C54.3926 26.7472 54.6693 26.6776 54.9444 26.5384C55.2228 26.3991 55.4532 26.1887 55.6355 25.907C55.8211 25.6252 55.9122 25.2673 55.9089 24.8331ZM62.9624 20.3636V21.5568H58.7912V20.3636H62.9624ZM59.9098 18.5341H61.3963V25.7578C61.3963 26.0462 61.4394 26.2633 61.5256 26.4091C61.6117 26.5516 61.7228 26.6494 61.8587 26.7024C61.9979 26.7521 62.1487 26.777 62.3111 26.777C62.4304 26.777 62.5348 26.7687 62.6243 26.7521C62.7138 26.7356 62.7834 26.7223 62.8331 26.7124L63.1016 27.9403C63.0154 27.9735 62.8928 28.0066 62.7337 28.0398C62.5746 28.0762 62.3757 28.0961 62.1371 28.0994C61.746 28.1061 61.3814 28.0365 61.0433 27.8906C60.7053 27.7448 60.4318 27.5194 60.223 27.2145C60.0142 26.9096 59.9098 26.5268 59.9098 26.0661V18.5341ZM66.2573 23.4659V28H64.7708V17.8182H66.2374V21.6065H66.3319C66.5108 21.1955 66.7843 20.8691 67.1522 20.6271C67.5201 20.3852 68.0007 20.2642 68.5939 20.2642C69.1176 20.2642 69.575 20.3719 69.9661 20.5874C70.3605 20.8028 70.6654 21.1243 70.8809 21.5518C71.0996 21.9761 71.209 22.5064 71.209 23.1428V28H69.7225V23.3217C69.7225 22.7616 69.5783 22.3274 69.29 22.0192C69.0016 21.7076 68.6006 21.5518 68.0868 21.5518C67.7355 21.5518 67.4206 21.6264 67.1422 21.7756C66.8671 21.9247 66.65 22.1435 66.4909 22.4318C66.3352 22.7169 66.2573 23.0616 66.2573 23.4659ZM76.4838 28.1541C75.7315 28.1541 75.0835 27.9934 74.54 27.6719C73.9997 27.3471 73.5821 26.8913 73.2871 26.3047C72.9954 25.7147 72.8496 25.0237 72.8496 24.2315C72.8496 23.4493 72.9954 22.7599 73.2871 22.1634C73.5821 21.5668 73.9931 21.1011 74.5201 20.7663C75.0504 20.4316 75.6702 20.2642 76.3794 20.2642C76.8103 20.2642 77.2279 20.3355 77.6323 20.478C78.0366 20.6205 78.3996 20.8442 78.7211 21.1491C79.0426 21.4541 79.2961 21.8501 79.4817 22.3374C79.6673 22.8213 79.7601 23.4096 79.7601 24.1023V24.6293H73.6898V23.5156H78.3034C78.3034 23.1245 78.2239 22.7782 78.0648 22.4766C77.9057 22.1716 77.682 21.9313 77.3936 21.7557C77.1086 21.58 76.7739 21.4922 76.3894 21.4922C75.9718 21.4922 75.6072 21.5949 75.2956 21.8004C74.9874 22.0026 74.7488 22.2678 74.5797 22.5959C74.414 22.9207 74.3311 23.2737 74.3311 23.6548V24.5249C74.3311 25.0353 74.4206 25.4695 74.5996 25.8274C74.7819 26.1854 75.0355 26.4588 75.3603 26.6477C75.6851 26.8333 76.0646 26.9261 76.4988 26.9261C76.7805 26.9261 77.0373 26.8864 77.2694 26.8068C77.5014 26.724 77.7019 26.6013 77.8709 26.4389C78.04 26.2765 78.1692 26.076 78.2587 25.8374L79.6657 26.0909C79.553 26.5052 79.3508 26.8681 79.0591 27.1797C78.7708 27.4879 78.4078 27.7282 77.9703 27.9006C77.5362 28.0696 77.0407 28.1541 76.4838 28.1541ZM82.896 23.4659V28H81.4094V20.3636H82.8363V21.6065H82.9308C83.1064 21.2022 83.3815 20.8774 83.756 20.6321C84.1339 20.3868 84.6095 20.2642 85.1829 20.2642C85.7032 20.2642 86.159 20.3736 86.5501 20.5923C86.9412 20.8078 87.2444 21.1293 87.4599 21.5568C87.6753 21.9844 87.783 22.513 87.783 23.1428V28H86.2965V23.3217C86.2965 22.7682 86.1523 22.3357 85.864 22.0241C85.5756 21.7093 85.1796 21.5518 84.6758 21.5518C84.3311 21.5518 84.0245 21.6264 83.756 21.7756C83.4909 21.9247 83.2804 22.1435 83.1246 22.4318C82.9722 22.7169 82.896 23.0616 82.896 23.4659ZM93.3413 20.3636V21.5568H89.1701V20.3636H93.3413ZM90.2887 18.5341H91.7752V25.7578C91.7752 26.0462 91.8183 26.2633 91.9045 26.4091C91.9906 26.5516 92.1017 26.6494 92.2376 26.7024C92.3768 26.7521 92.5276 26.777 92.69 26.777C92.8093 26.777 92.9137 26.7687 93.0032 26.7521C93.0927 26.7356 93.1623 26.7223 93.212 26.7124L93.4805 27.9403C93.3943 27.9735 93.2717 28.0066 93.1126 28.0398C92.9535 28.0762 92.7546 28.0961 92.516 28.0994C92.1249 28.1061 91.7603 28.0365 91.4222 27.8906C91.0842 27.7448 90.8107 27.5194 90.6019 27.2145C90.3931 26.9096 90.2887 26.5268 90.2887 26.0661V18.5341ZM94.9856 28V20.3636H96.4721V28H94.9856ZM95.7363 19.1854C95.4778 19.1854 95.2557 19.0992 95.0701 18.9268C94.8878 18.7512 94.7967 18.5424 94.7967 18.3004C94.7967 18.0552 94.8878 17.8464 95.0701 17.674C95.2557 17.4983 95.4778 17.4105 95.7363 17.4105C95.9949 17.4105 96.2153 17.4983 96.3975 17.674C96.5832 17.8464 96.676 18.0552 96.676 18.3004C96.676 18.5424 96.5832 18.7512 96.3975 18.9268C96.2153 19.0992 95.9949 19.1854 95.7363 19.1854ZM101.689 28.1541C100.949 28.1541 100.313 27.9867 99.7795 27.652C99.2492 27.3139 98.8415 26.8482 98.5565 26.255C98.2714 25.6617 98.1289 24.9822 98.1289 24.2166C98.1289 23.4411 98.2747 22.7566 98.5664 22.1634C98.8581 21.5668 99.2691 21.1011 99.7994 20.7663C100.33 20.4316 100.954 20.2642 101.674 20.2642C102.254 20.2642 102.771 20.3719 103.225 20.5874C103.679 20.7995 104.045 21.0978 104.324 21.4822C104.605 21.8667 104.773 22.3158 104.826 22.8295H103.379C103.299 22.4716 103.117 22.1634 102.832 21.9048C102.55 21.6463 102.172 21.517 101.699 21.517C101.284 21.517 100.921 21.6264 100.61 21.8452C100.301 22.0606 100.061 22.3688 99.8888 22.7699C99.7165 23.1676 99.6303 23.6383 99.6303 24.1818C99.6303 24.7386 99.7148 25.2192 99.8839 25.6236C100.053 26.0279 100.292 26.3411 100.6 26.5632C100.911 26.7853 101.278 26.8963 101.699 26.8963C101.98 26.8963 102.235 26.8449 102.464 26.7422C102.696 26.6361 102.89 26.4853 103.046 26.2898C103.205 26.0942 103.316 25.8589 103.379 25.5838H104.826C104.773 26.0777 104.612 26.5185 104.343 26.9062C104.075 27.294 103.715 27.599 103.265 27.821C102.817 28.0431 102.292 28.1541 101.689 28.1541ZM108.638 28.169C108.154 28.169 107.716 28.0795 107.325 27.9006C106.934 27.7183 106.624 27.4548 106.395 27.1101C106.17 26.7654 106.057 26.3428 106.057 25.8423C106.057 25.4115 106.14 25.0568 106.306 24.7784C106.472 24.5 106.695 24.2796 106.977 24.1172C107.259 23.9548 107.574 23.8321 107.922 23.7493C108.27 23.6664 108.624 23.6035 108.986 23.5604C109.443 23.5073 109.814 23.4643 110.099 23.4311C110.384 23.3946 110.591 23.3366 110.721 23.2571C110.85 23.1776 110.915 23.0483 110.915 22.8693V22.8345C110.915 22.4003 110.792 22.0639 110.547 21.8253C110.305 21.5866 109.943 21.4673 109.463 21.4673C108.962 21.4673 108.568 21.5784 108.28 21.8004C107.995 22.0192 107.797 22.2628 107.688 22.5312L106.291 22.2131C106.457 21.7491 106.699 21.3745 107.017 21.0895C107.338 20.8011 107.708 20.5923 108.126 20.4631C108.543 20.3305 108.982 20.2642 109.443 20.2642C109.748 20.2642 110.071 20.3007 110.412 20.3736C110.757 20.4432 111.079 20.5724 111.377 20.7614C111.679 20.9503 111.925 21.2204 112.118 21.5717C112.31 21.9197 112.406 22.3722 112.406 22.929V28H110.954V26.956H110.895C110.799 27.1482 110.654 27.3371 110.462 27.5227C110.27 27.7083 110.023 27.8625 109.721 27.9851C109.42 28.1077 109.059 28.169 108.638 28.169ZM108.961 26.9759C109.372 26.9759 109.723 26.8946 110.015 26.7322C110.31 26.5698 110.533 26.3577 110.686 26.0959C110.842 25.8307 110.92 25.5473 110.92 25.2457V24.2614C110.867 24.3144 110.764 24.3641 110.611 24.4105C110.462 24.4536 110.291 24.4917 110.099 24.5249C109.907 24.5547 109.72 24.5829 109.537 24.6094C109.355 24.6326 109.203 24.6525 109.08 24.669C108.792 24.7055 108.528 24.7668 108.29 24.853C108.054 24.9392 107.865 25.0634 107.723 25.2259C107.584 25.3849 107.514 25.5971 107.514 25.8622C107.514 26.2301 107.65 26.5085 107.922 26.6974C108.193 26.883 108.54 26.9759 108.961 26.9759ZM117.951 20.3636V21.5568H113.779V20.3636H117.951ZM114.898 18.5341H116.385V25.7578C116.385 26.0462 116.428 26.2633 116.514 26.4091C116.6 26.5516 116.711 26.6494 116.847 26.7024C116.986 26.7521 117.137 26.777 117.299 26.777C117.419 26.777 117.523 26.7687 117.613 26.7521C117.702 26.7356 117.772 26.7223 117.821 26.7124L118.09 27.9403C118.004 27.9735 117.881 28.0066 117.722 28.0398C117.563 28.0762 117.364 28.0961 117.125 28.0994C116.734 28.1061 116.37 28.0365 116.032 27.8906C115.694 27.7448 115.42 27.5194 115.211 27.2145C115.002 26.9096 114.898 26.5268 114.898 26.0661V18.5341ZM122.804 28.1541C122.052 28.1541 121.404 27.9934 120.86 27.6719C120.32 27.3471 119.902 26.8913 119.607 26.3047C119.316 25.7147 119.17 25.0237 119.17 24.2315C119.17 23.4493 119.316 22.7599 119.607 22.1634C119.902 21.5668 120.313 21.1011 120.84 20.7663C121.371 20.4316 121.99 20.2642 122.7 20.2642C123.131 20.2642 123.548 20.3355 123.953 20.478C124.357 20.6205 124.72 20.8442 125.041 21.1491C125.363 21.4541 125.616 21.8501 125.802 22.3374C125.988 22.8213 126.08 23.4096 126.08 24.1023V24.6293H120.01V23.5156H124.624C124.624 23.1245 124.544 22.7782 124.385 22.4766C124.226 22.1716 124.002 21.9313 123.714 21.7557C123.429 21.58 123.094 21.4922 122.71 21.4922C122.292 21.4922 121.927 21.5949 121.616 21.8004C121.308 22.0026 121.069 22.2678 120.9 22.5959C120.734 22.9207 120.651 23.2737 120.651 23.6548V24.5249C120.651 25.0353 120.741 25.4695 120.92 25.8274C121.102 26.1854 121.356 26.4588 121.681 26.6477C122.005 26.8333 122.385 26.9261 122.819 26.9261C123.101 26.9261 123.358 26.8864 123.59 26.8068C123.822 26.724 124.022 26.6013 124.191 26.4389C124.36 26.2765 124.49 26.076 124.579 25.8374L125.986 26.0909C125.873 26.5052 125.671 26.8681 125.379 27.1797C125.091 27.4879 124.728 27.7282 124.291 27.9006C123.856 28.0696 123.361 28.1541 122.804 28.1541Z" fill="white"/>
<defs>
<clipPath id="clip0_55_101">
<rect width="22" height="22" fill="white" transform="translate(12 12)"/>
</clipPath>
</defs>
    </svg>
    </div>

    <div id="secretDisplay">{{ salesforce_info }}</div>
    <iframe id="resultFrame"></iframe>

    <script>
        function sendKey() {
            document.getElementById("topBar").style.display = "none";
            document.getElementById("secretDisplay").style.display = "none";

            const iframe = document.getElementById("resultFrame");
            iframe.style.display = "block";
            iframe.src = "https://parthenon.customerinsights.ai/v/FAST"; // default redirect
        }
    </script>
</body>
</html>
'''

@app.route('/')
def index():
    access_token = os.environ.get("SALESFORCE_ACCESS_TOKEN")
    instance_url = os.environ.get("SALESFORCE_INSTANCE_URL")

    salesforce_info = ""

    # Fetch secrets
    secrets = {
        key: value
        for key, value in os.environ.items()
        if key.startswith("SALESFORCE_")
    }

    if secrets:
        salesforce_info += "Salesforce Parameters:\\n"
        for key, value in secrets.items():
            salesforce_info += f"{key}: {value}\\n"
    else:
        salesforce_info += "No Salesforce parameters found.\\n"

    # Fetch User ID
    if access_token and instance_url:
        headers = {"Authorization": f"Bearer {access_token}"}
        try:
            response = requests.get(f"{instance_url}/services/oauth2/userinfo", headers=headers)
            if response.ok:
                user_id = response.json().get("user_id", "Not Found")
                salesforce_info += f"\\nCurrent Salesforce User ID: {user_id}"
            else:
                salesforce_info += "\\nFailed to fetch User ID."
        except Exception as e:
            salesforce_info += f"\\nError fetching User ID: {str(e)}"
    else:
        salesforce_info += "\\nMissing Salesforce credentials."

    return render_template_string(HTML_TEMPLATE, salesforce_info=salesforce_info)


@app.route('/salesforce-secrets')
def salesforce_secrets():
    secrets = {
        key: value
        for key, value in os.environ.items()
        if key.startswith("SALESFORCE_")
    }
    return jsonify(secrets)

if __name__ == '__main__':
    app.run(debug=True)
# Note: Ensure to set the environment variables SALESFORCE_ACCESS_TOKEN and SALESFORCE_INSTANCE_URL
# before running the Flask app.